{
    "contents" : "#' Compute the Snew P and Bnew\n#'\n#' This function computes the new bayesian estimator\n#'\n#' @param Y binary repsonse vector length of n\n#' @param X binary exposure vector same length with Y\n#' @param C binary confounder matrix n*r, r the number of counfouders\n#' @param k_q(1) prior parameter of the Dirichlet distribution for Pr(C=c)\n#' @param mean(0.01,0.99),con(1,20) the range of the grid for the hyperparameter of the saturated new estimate\n#' @param BinMean(20),BinCon(20) control the number of new-added points \n#' @param kappa(0.5) the prior weight when calculating the bayesian esimate\n#' @param beta the prior of the paramatric estimate\n#' @param Mc.error(0.001), controls the Mc.error when estimating the parametric estimate\n#' @param addBin(10) n_2\n#' @return a list of saturated, bayesian estimate and paramatric estimate\n#' @seealso AllEst_C\n#' @export\n#' @importFrom plyr dlply\n#' @importFrom boot inv.logit\n#' @importFrom LaplacesDemon as.inverse\n#' @importFrom mnormt dmnorm\n#' @examples \n#' \\dontrun{\n#' data(sampleDat)\n#' Y=sample.dataset$Y\n#' X=sample.dataset$X\n#' C=sample.dataset$C\n#' bay.est.new(Y,X,C)\n#' }\nbay.est.new <- function(Y,X,C,k_q,mean,BinMean,con,BinCon,addBin,kappa,beta,Mc.error,liketype,Dat)\n  {\n  if (missing(Y)|missing(X)|missing(C)) {Y=Dat$Y;X=Dat$X;C=Dat[,paste0(\"C\",1:(ncol(Dat)-2))]}\n  if (missing(Dat)&(missing(Y)|missing(X)|missing(C))) stop(\"Data entry wrong Y or X or C or Dat is missing\") \n  if (missing(k_q)) k_q=1\n  if (missing(mean)) mean=c(0.01,0.99)\n  if (missing(con)) con=c(1,20)\n  if (missing(BinMean)) BinMean=20\n  if (missing(BinCon)) BinCon=20\n  if (missing(beta)) {beta=30^2*diag(rep(1,ncol(C)+2))}\n  if (missing(Mc.error)) Mc.error=0.001\n  if (missing(kappa)) kappa=0.5\n  if (missing(addBin)) addBin=10\n  if (missing(liketype)) liketype=\"bernoulli\"\n  \n  temp.p = para.est(Y,X,C,beta=beta,k_q=k_q,Mc.error=Mc.error)\n  estimate.p = temp.p$P\n  likelihood.p=temp.p$likelihood\n  temp.s.new <- sat.est.new(Y,X,C,k_q,mean,BinMean,con,BinCon,addBin,liketype=liketype)\n  likelihood.new = temp.s.new$likelihood.new\n  estimate.s.new = temp.s.new$est.new\n  ratio.likelihood.new<- exp(likelihood.new - likelihood.p)\n  w.new <- kappa/(kappa+(1-kappa)*ratio.likelihood.new)\n  estimate.b.new <- w.new*estimate.p+(1-w.new)*estimate.s.new # bayesian estimate for hirarchical version\n  \n  \n  return(\n    list(est=c(Snew=estimate.s.new, \n         P=estimate.p,\n         Bnew=estimate.b.new),\n         likelihood=c(l.p=likelihood.p,l.Snew=likelihood.new)    \n         )\n  )  \n}\n",
    "created" : 1374083222999.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2508493817",
    "id" : "5E8AEFBD",
    "lastKnownWriteTime" : 1373635583,
    "path" : "~/Dropbox/UBC/CinR/FileOnSever/Mypackages/Import/R/bay.new.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}